{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\sungh\\\\Desktop\\\\chat_work_ver3\\\\frontend\\\\src\\\\features\\\\shared\\\\components\\\\ChatArea.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport Message from './Message';\nimport MessageInput from './MessageInput';\nimport TrainingCategoryView from '../../training/components/TrainingCategoryView';\nimport InterpretationView from '../../training/components/InterpretationView';\nimport ProceedView from '../../training/components/ProceedView';\nimport SentenceView from '../../training/components/SentenceView';\nimport PersonaAdminPanel from '../../admin/components/PersonaAdminPanel';\nimport LoadingMessage from './LoadingMessage';\nimport { chatApi } from '../api/chatApi';\nimport { MainArea, ChatContent, EmptyState, EmptyStateTitle, EmptyStateText } from '../styles/GlobalStyle';\nimport InteractionHistoryView from '../../training/components/InteractionHistoryView';\nimport VerbalizationView from '../../verbalization/components/VerbalizationView';\n\n// Helper and styled components from RecentInteractionsView\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst getThreadTypeLabel = type => {\n  switch (type) {\n    case 'interpretation':\n      return '해석';\n    case 'proceed':\n      return '나아가기';\n    case 'sentence':\n      return '문장';\n    case 'verbalization':\n      return '언어화';\n    default:\n      return type;\n  }\n};\nconst RecentInteractionHeader = styled.div`\n  padding: 20px;\n  border-bottom: 1px solid #e0e0e0;\n  background: #f8f9fa;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  height: 81px;\n  box-sizing: border-box;\n`;\n_c = RecentInteractionHeader;\nconst RecentInteractionTitle = styled.h2`\n  font-size: 24px;\n  font-weight: 600;\n  color: #333;\n  margin: 0;\n`;\n_c2 = RecentInteractionTitle;\nconst NavigateButton = styled.button`\n  padding: 10px 20px;\n  background: linear-gradient(90deg, #ffffff 0%, #f0f0f0 100%);\n  border: 1px solid #ccc;\n  border-radius: 12px;\n  color: #333;\n  font-size: 14px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  \n  &:hover {\n    background: linear-gradient(90deg, #f8f8f8 0%, #e8e8e8 100%);\n    transform: translateY(-1px);\n    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);\n  }\n  \n  &:active {\n    transform: translateY(0);\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  }\n`;\n_c3 = NavigateButton;\nconst ChatArea = ({\n  selectedConversation,\n  conversations,\n  personas,\n  globalMessages,\n  isLoading,\n  error,\n  onSendInitialMessage,\n  onContinueConversation,\n  onClearError,\n  selectedPersonaItem,\n  onSelectPersona,\n  onInterpretationComplete,\n  selectedConversationItem,\n  currentInterpretation,\n  onInterpretationMessage,\n  onUpdateInterpretation,\n  onUpdateConversation,\n  onSwitchConversationMode,\n  onRefreshConversationSidebar,\n  recentInteractionsProps,\n  verbalizationProps,\n  viewingRecentThread,\n  isRecentThreadLoading,\n  onNavigateToThread\n}) => {\n  _s();\n  var _personas$currentConv, _personas$currentConv2, _personas$currentConv3;\n  const chatContentRef = useRef(null);\n  const currentConversation = selectedConversation ? conversations[selectedConversation] : null;\n\n  // 편집 상태 관리\n  const [editingMessageIndex, setEditingMessageIndex] = useState(null);\n\n  // 훈습 관련 상태\n  const [threads, setThreads] = useState([]);\n  const [proceedContent, setProceedContent] = useState('');\n  const [sentenceContent, setSentenceContent] = useState('');\n  const [interactionRecords, setInteractionRecords] = useState([]);\n\n  // 메시지가 추가될 때마다 스크롤을 맨 아래로\n  useEffect(() => {\n    if (chatContentRef.current) {\n      chatContentRef.current.scrollTop = chatContentRef.current.scrollHeight;\n    }\n  }, [currentConversation === null || currentConversation === void 0 ? void 0 : currentConversation.messages, globalMessages, isLoading]);\n\n  // 훈습 데이터 로딩을 더 정확하게 수정\n  useEffect(() => {\n    const loadTrainingData = async () => {\n      if (!(currentInterpretation !== null && currentInterpretation !== void 0 && currentInterpretation.personaId)) return;\n      try {\n        // 스레드 데이터 로드\n        const threadsResponse = await chatApi.getPersonaThreads(currentInterpretation.personaId);\n        if (threadsResponse.data) {\n          setThreads(threadsResponse.data);\n\n          // 나아가기와 문장 스레드에서 콘텐츠 추출\n          const proceedThread = threadsResponse.data.find(t => t.thread_type === 'proceed');\n          const sentenceThread = threadsResponse.data.find(t => t.thread_type === 'sentence');\n          if (proceedThread && proceedThread.messages.length > 0) {\n            const firstProceedMessage = proceedThread.messages.find(m => m.role === 'assistant');\n            if (firstProceedMessage) {\n              setProceedContent(firstProceedMessage.content);\n            }\n          }\n          if (sentenceThread && sentenceThread.messages.length > 0) {\n            const firstSentenceMessage = sentenceThread.messages.find(m => m.role === 'assistant');\n            if (firstSentenceMessage) {\n              setSentenceContent(firstSentenceMessage.content);\n            }\n          }\n        }\n      } catch (error) {\n        console.error('훈습 데이터 로드 실패:', error);\n      }\n    };\n    loadTrainingData();\n  }, [currentInterpretation === null || currentInterpretation === void 0 ? void 0 : currentInterpretation.personaId]);\n\n  // 스레드 업데이트 시 콘텐츠도 업데이트\n  useEffect(() => {\n    const proceedThread = threads.find(t => t.thread_type === 'proceed');\n    const sentenceThread = threads.find(t => t.thread_type === 'sentence');\n    if (proceedThread && proceedThread.messages.length > 0) {\n      const firstProceedMessage = proceedThread.messages.find(m => m.role === 'assistant');\n      if (firstProceedMessage) {\n        setProceedContent(firstProceedMessage.content);\n      }\n    }\n    if (sentenceThread && sentenceThread.messages.length > 0) {\n      const firstSentenceMessage = sentenceThread.messages.find(m => m.role === 'assistant');\n      if (firstSentenceMessage) {\n        setSentenceContent(firstSentenceMessage.content);\n      }\n    }\n  }, [threads]);\n\n  // 상호작용 기록 로드\n  useEffect(() => {\n    const loadInteractionRecords = async () => {\n      try {\n        const recordsResponse = await chatApi.getAllInteractionRecords();\n        if (recordsResponse.data) {\n          setInteractionRecords(recordsResponse.data);\n        }\n      } catch (error) {\n        console.error('상호작용 기록 로드 실패:', error);\n      }\n    };\n    loadInteractionRecords();\n  }, [currentInterpretation, threads]); // threads나 currentInterpretation이 변경될 때마다 새로고침\n\n  const handleSendMessage = async message => {\n    let success = false;\n    if (selectedConversation) {\n      // 기존 대화에 메시지 추가\n      success = await onContinueConversation(selectedConversation, message);\n    } else if (currentInterpretation) {\n      // 해석 모드에서는 해석 관련 메시지 전송\n      success = await onInterpretationMessage(message);\n    } else {\n      // 새로운 대화 시작\n      success = await onSendInitialMessage(message);\n    }\n    if (success && onRefreshConversationSidebar) {\n      console.log('메시지 전송 성공, ConversationSidebar 새로고침 실행');\n      onRefreshConversationSidebar();\n    }\n    return success;\n  };\n\n  // 해석 메시지 수정 핸들러\n  const handleEditInterpretationMessage = async (messageIndex, newContent) => {\n    if (!currentInterpretation) return false;\n    try {\n      // 메시지 수정 - 수정 후 새로운 응답 자동 생성\n      const updatedMessages = [...currentInterpretation.messages];\n      if (messageIndex >= 0 && messageIndex < updatedMessages.length) {\n        // 수정된 메시지 업데이트\n        updatedMessages[messageIndex] = {\n          ...updatedMessages[messageIndex],\n          content: newContent,\n          timestamp: new Date().toISOString()\n        };\n\n        // 수정된 메시지 이후의 모든 메시지들 제거\n        const filteredMessages = updatedMessages.slice(0, messageIndex + 1);\n\n        // 백엔드 API를 통해 새로운 AI 응답 생성\n        try {\n          const response = await chatApi.chatWithInterpretation(currentInterpretation.personaId, newContent);\n          if (response.data) {\n            const aiResponse = {\n              role: 'assistant',\n              content: response.data.response,\n              timestamp: response.data.timestamp\n            };\n            const updatedInterpretation = {\n              ...currentInterpretation,\n              messages: [...filteredMessages, aiResponse]\n            };\n\n            // 상위 컴포넌트에 업데이트 알림\n            if (onUpdateInterpretation) {\n              onUpdateInterpretation(updatedInterpretation);\n            }\n            return true;\n          } else {\n            // API 호출 실패 시 로컬에서 임시 응답 생성\n            const aiResponse = {\n              role: 'assistant',\n              content: `${currentInterpretation.personaName}의 관점에서 수정된 메시지에 대해 새롭게 응답드리겠습니다.\\n\\n\"${newContent}\"에 대해 분석해보면, 이는 이전과는 다른 맥락을 제시하고 있습니다. 수정된 내용을 바탕으로 새로운 해석과 통찰을 제공하겠습니다.`,\n              timestamp: new Date().toISOString()\n            };\n            const updatedInterpretation = {\n              ...currentInterpretation,\n              messages: [...filteredMessages, aiResponse]\n            };\n            if (onUpdateInterpretation) {\n              onUpdateInterpretation(updatedInterpretation);\n            }\n            return true;\n          }\n        } catch (apiError) {\n          console.error('해석 API 호출 실패:', apiError);\n\n          // API 호출 실패 시 로컬에서 임시 응답 생성\n          const aiResponse = {\n            role: 'assistant',\n            content: `${currentInterpretation.personaName}의 관점에서 수정된 메시지에 대해 새롭게 응답드리겠습니다.\\n\\n\"${newContent}\"에 대해 분석해보면, 이는 이전과는 다른 맥락을 제시하고 있습니다. 수정된 내용을 바탕으로 새로운 해석과 통찰을 제공하겠습니다.`,\n            timestamp: new Date().toISOString()\n          };\n          const updatedInterpretation = {\n            ...currentInterpretation,\n            messages: [...filteredMessages, aiResponse]\n          };\n          if (onUpdateInterpretation) {\n            onUpdateInterpretation(updatedInterpretation);\n          }\n          return true;\n        }\n      }\n      return false;\n    } catch (error) {\n      console.error('해석 메시지 수정 실패:', error);\n      return false;\n    }\n  };\n\n  // 일반 대화 메시지 수정 핸들러\n  const handleEditConversationMessage = async (messageIndex, newContent) => {\n    if (!selectedConversation || !currentConversation) return false;\n    try {\n      var _result$data;\n      const result = await chatApi.editMessage(selectedConversation, messageIndex, newContent);\n      if ((_result$data = result.data) !== null && _result$data !== void 0 && _result$data.success && result.data.updated_conversation) {\n        // 수정된 대화 정보로 즉시 UI 업데이트\n        if (onUpdateConversation) {\n          onUpdateConversation(result.data.updated_conversation);\n        }\n        return true;\n      } else {\n        console.error('메시지 수정 실패:', result.error);\n        return false;\n      }\n    } catch (error) {\n      console.error('메시지 수정 요청 실패:', error);\n      return false;\n    }\n  };\n  const renderInitialResponses = () => {\n    if (!globalMessages.length) return null;\n    const latestMessage = globalMessages[globalMessages.length - 1];\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(Message, {\n        message: {\n          role: 'user',\n          content: latestMessage.user_message,\n          timestamp: latestMessage.timestamp\n        },\n        personas: personas,\n        showActionButtons: false\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 396,\n        columnNumber: 9\n      }, this), latestMessage.responses.map(response => /*#__PURE__*/_jsxDEV(Message, {\n        message: {\n          role: 'assistant',\n          content: response.content,\n          timestamp: response.timestamp,\n          persona_id: response.persona_id,\n          persona_name: response.persona_name\n        },\n        personas: personas,\n        showActionButtons: true\n      }, `${latestMessage.id}_${response.persona_id}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 408,\n        columnNumber: 11\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          margin: '20px 0',\n          padding: '16px',\n          backgroundColor: '#f8f8f8',\n          borderRadius: '8px',\n          border: 'none',\n          textAlign: 'center'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: '14px',\n            color: '#666',\n            marginBottom: '8px'\n          },\n          children: \"\\uD83D\\uDCA1 \\uAC01 \\uD398\\uB974\\uC18C\\uB098\\uC640 \\uAC1C\\uBCC4\\uC801\\uC73C\\uB85C \\uB300\\uD654\\uB97C \\uC774\\uC5B4\\uAC00\\uB824\\uBA74\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 430,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: '13px',\n            color: '#888'\n          },\n          children: \"\\uC67C\\uCABD \\uC0AC\\uC774\\uB4DC\\uBC14\\uC5D0\\uC11C \\uD398\\uB974\\uC18C\\uB098\\uB97C \\uC120\\uD0DD\\uD558\\uAC70\\uB098, \\uD2B9\\uC815 \\uB300\\uD654\\uB97C \\uC120\\uD0DD\\uD558\\uC138\\uC694\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 433,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 422,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 394,\n      columnNumber: 7\n    }, this);\n  };\n  const renderConversation = () => {\n    if (!currentConversation) return null;\n    return currentConversation.messages.map((message, index) => /*#__PURE__*/_jsxDEV(Message, {\n      message: message,\n      personas: personas,\n      showActionButtons: true,\n      onCopy: () => {\n        navigator.clipboard.writeText(message.content);\n      },\n      onEdit: message.role === 'user' ? () => setEditingMessageIndex(index) : undefined,\n      onEditSave: message.role === 'user' ? async newContent => {\n        const success = await handleEditConversationMessage(index, newContent);\n        if (success) {\n          setEditingMessageIndex(null);\n        }\n        return success;\n      } : undefined,\n      onEditCancel: () => setEditingMessageIndex(null),\n      isEditing: editingMessageIndex === index,\n      onSunAction: () => {},\n      onPersonAction: () => {},\n      onDocumentAction: () => {}\n    }, `${currentConversation.id}_${index}`, false, {\n      fileName: _jsxFileName,\n      lineNumber: 445,\n      columnNumber: 7\n    }, this));\n  };\n  const renderEmptyState = () => /*#__PURE__*/_jsxDEV(EmptyState, {\n    children: [/*#__PURE__*/_jsxDEV(EmptyStateTitle, {\n      children: \"\\uC0C8\\uB85C\\uC6B4 \\uB300\\uD654\\uB97C \\uC2DC\\uC791\\uD574\\uBCF4\\uC138\\uC694!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 472,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(EmptyStateText, {\n      children: Object.keys(personas).length > 0 ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [\"\\uC544\\uB798\\uC5D0 \\uC9C8\\uBB38\\uC744 \\uC785\\uB825\\uD558\\uBA74 \", Object.keys(personas).length, \"\\uAC1C\\uC758 \\uD398\\uB974\\uC18C\\uB098\\uAC00\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 476,\n          columnNumber: 64\n        }, this), \"\\uAC01\\uAC01 \\uB2E4\\uB978 \\uAD00\\uC810\\uC5D0\\uC11C \\uB2F5\\uBCC0\\uD574\\uB4DC\\uB9BD\\uB2C8\\uB2E4.\"]\n      }, void 0, true) : '페르소나 정보를 불러오는 중입니다...'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 473,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 471,\n    columnNumber: 5\n  }, this);\n\n  // 모드 전환 핸들러\n  const handleSwitchToMode = mode => {\n    if (onSwitchConversationMode) {\n      onSwitchConversationMode(mode);\n    }\n  };\n\n  // 새로운 해석 생성 핸들러\n  const handleGenerateNewInterpretation = async () => {\n    if (!(currentInterpretation !== null && currentInterpretation !== void 0 && currentInterpretation.personaId)) return;\n    try {\n      // 새로운 해석을 생성하고 완료 콜백 호출\n      onInterpretationComplete(currentInterpretation.personaId, '새로운 해석을 생성합니다...');\n    } catch (error) {\n      console.error('새로운 해석 생성 실패:', error);\n    }\n  };\n\n  // 선택된 스레드 추출\n  const getSelectedThread = conversationItem => {\n    if (!conversationItem || !conversationItem.includes('-thread-')) return null;\n    const threadId = conversationItem.split('-thread-')[1];\n    return threads.find(thread => thread.id === threadId) || null;\n  };\n\n  // 스레드 새로고침 함수\n  const handleRefreshThreads = async () => {\n    if (!(currentInterpretation !== null && currentInterpretation !== void 0 && currentInterpretation.personaId)) return;\n    try {\n      console.log('=== 스레드 새로고침 시작 ===');\n      console.log('personaId:', currentInterpretation.personaId);\n\n      // 1. 스레드 정보 새로고침\n      const threadsResponse = await chatApi.getPersonaThreads(currentInterpretation.personaId);\n      if (threadsResponse.data) {\n        const updatedThreads = threadsResponse.data;\n        setThreads(updatedThreads);\n        console.log('스레드 업데이트 완료:', updatedThreads.length, '개');\n\n        // 콘텐츠 업데이트\n        const proceedThread = updatedThreads.find(t => t.thread_type === 'proceed');\n        const sentenceThread = updatedThreads.find(t => t.thread_type === 'sentence');\n        if (proceedThread && proceedThread.messages.length > 0) {\n          const firstProceedMessage = proceedThread.messages.find(m => m.role === 'assistant');\n          if (firstProceedMessage) {\n            setProceedContent(firstProceedMessage.content);\n          }\n        }\n        if (sentenceThread && sentenceThread.messages.length > 0) {\n          const firstSentenceMessage = sentenceThread.messages.find(m => m.role === 'assistant');\n          if (firstSentenceMessage) {\n            setSentenceContent(firstSentenceMessage.content);\n          }\n        }\n      }\n\n      // 2. 해석 내용도 새로고침 (중요!)\n      try {\n        console.log('해석 내용 새로고침 시작...');\n        const interpretationResponse = await chatApi.getInterpretation(currentInterpretation.personaId);\n        if (interpretationResponse.data) {\n          console.log('해석 내용 업데이트:', interpretationResponse.data.interpretation.substring(0, 100) + '...');\n\n          // 해석 내용 업데이트\n          const updatedInterpretation = {\n            ...currentInterpretation,\n            content: interpretationResponse.data.interpretation\n          };\n          if (onUpdateInterpretation) {\n            onUpdateInterpretation(updatedInterpretation);\n            console.log('해석 내용 업데이트 완료');\n          }\n        }\n      } catch (interpretationError) {\n        console.warn('해석 내용 새로고침 실패:', interpretationError);\n      }\n\n      // 3. 상호작용 기록도 새로고침 (해석 저장이 반영되도록)\n      try {\n        console.log('상호작용 기록 새로고침 시작...');\n        const interactionResponse = await chatApi.getAllInteractionRecords();\n        if (interactionResponse.data) {\n          setInteractionRecords(interactionResponse.data);\n          console.log('상호작용 기록 업데이트 완료:', interactionResponse.data.length, '개');\n        }\n      } catch (interactionError) {\n        console.warn('상호작용 기록 새로고침 실패:', interactionError);\n      }\n\n      // 4. ConversationSidebar 새로고침\n      if (onRefreshConversationSidebar) {\n        console.log('ConversationSidebar 새로고침 트리거...');\n        onRefreshConversationSidebar();\n      }\n      console.log('=== 스레드 새로고침 완료 ===');\n    } catch (error) {\n      console.error('스레드 새로고침 실패:', error);\n    }\n  };\n\n  // 해석 뷰 렌더링\n  const renderInterpretationView = () => {\n    var _selectedThread;\n    if (!currentInterpretation) return null;\n\n    // 해석 스레드가 명시적으로 선택된 경우에만 해당 스레드의 데이터 사용\n    const isInterpretationThread = selectedConversationItem === null || selectedConversationItem === void 0 ? void 0 : selectedConversationItem.startsWith('interpretation-thread-');\n    let selectedThread = null;\n    if (isInterpretationThread) {\n      selectedThread = getSelectedThread(selectedConversationItem);\n    }\n\n    // 사용할 메시지들 결정: 명시적으로 해석 스레드가 선택된 경우에만 스레드 메시지 사용\n    const messagesToShow = isInterpretationThread && selectedThread ? selectedThread.messages : currentInterpretation.messages;\n\n    // 사용할 해석 내용 결정: 명시적으로 해석 스레드가 선택된 경우에만 스레드 content 사용\n    const interpretationContent = isInterpretationThread && selectedThread ? selectedThread.content || (selectedThread.messages.length > 0 ? selectedThread.messages[0].content : currentInterpretation.content) : currentInterpretation.content;\n    console.log('해석 뷰 렌더링:', {\n      isInterpretationThread,\n      selectedThreadId: (_selectedThread = selectedThread) === null || _selectedThread === void 0 ? void 0 : _selectedThread.id,\n      selectedConversationItem,\n      messageCount: messagesToShow.length,\n      contentPreview: interpretationContent.substring(0, 100) + '...'\n    });\n    return /*#__PURE__*/_jsxDEV(InterpretationView, {\n      interpretation: interpretationContent,\n      personaName: currentInterpretation.personaName,\n      onSendMessage: onInterpretationMessage,\n      onEditMessage: handleEditInterpretationMessage,\n      isLoading: isLoading,\n      messages: messagesToShow,\n      onGenerateNewInterpretation: handleGenerateNewInterpretation,\n      onSwitchToMode: handleSwitchToMode,\n      personaId: currentInterpretation.personaId,\n      onRefreshThreads: handleRefreshThreads,\n      selectedThread: selectedThread\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 624,\n      columnNumber: 7\n    }, this);\n  };\n\n  // 나아가기 뷰 렌더링\n  const renderProceedView = () => {\n    if (!currentInterpretation) return null;\n    const selectedThread = getSelectedThread(selectedConversationItem);\n    return /*#__PURE__*/_jsxDEV(ProceedView, {\n      personaId: currentInterpretation.personaId,\n      personaName: currentInterpretation.personaName,\n      proceedContent: proceedContent || '나아가기를 생성하고 있습니다...',\n      threads: threads,\n      onSwitchToMode: handleSwitchToMode,\n      onGenerateNewInterpretation: handleGenerateNewInterpretation,\n      selectedThread: selectedThread,\n      onRefreshThreads: handleRefreshThreads\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 647,\n      columnNumber: 7\n    }, this);\n  };\n\n  // 문장 뷰 렌더링\n  const renderSentenceView = () => {\n    if (!currentInterpretation) return null;\n    const selectedThread = getSelectedThread(selectedConversationItem);\n    return /*#__PURE__*/_jsxDEV(SentenceView, {\n      personaId: currentInterpretation.personaId,\n      personaName: currentInterpretation.personaName,\n      sentenceContent: sentenceContent || '문장을 생성하고 있습니다...',\n      threads: threads,\n      onSwitchToMode: handleSwitchToMode,\n      onGenerateNewInterpretation: handleGenerateNewInterpretation,\n      selectedThread: selectedThread,\n      onRefreshThreads: handleRefreshThreads\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 667,\n      columnNumber: 7\n    }, this);\n  };\n\n  // 상호작용 기록 뷰 렌더링\n  const renderInteractionHistoryView = () => {\n    if (!currentInterpretation) return null;\n    return /*#__PURE__*/_jsxDEV(InteractionHistoryView, {\n      personaId: currentInterpretation.personaId,\n      personaName: currentInterpretation.personaName,\n      allInteractionRecords: interactionRecords,\n      onThreadSelect: handleInteractionThreadSelect,\n      onSwitchToMode: handleSwitchToMode,\n      onGenerateNewInterpretation: handleGenerateNewInterpretation\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 685,\n      columnNumber: 7\n    }, this);\n  };\n\n  // 상호작용 기록에서 스레드 선택 핸들러\n  const handleInteractionThreadSelect = thread => {\n    // 해당 스레드의 모드로 전환하고 스레드 선택\n    if (onSwitchConversationMode) {\n      onSwitchConversationMode(`${thread.thread_type}-thread-${thread.id}`);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(MainArea, {\n    children: selectedPersonaItem === 'recent' ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [viewingRecentThread ? /*#__PURE__*/_jsxDEV(RecentInteractionHeader, {\n        children: [/*#__PURE__*/_jsxDEV(RecentInteractionTitle, {\n          children: `${viewingRecentThread.persona_name} - ${getThreadTypeLabel(viewingRecentThread.thread_type)}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 710,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(NavigateButton, {\n          onClick: () => onNavigateToThread === null || onNavigateToThread === void 0 ? void 0 : onNavigateToThread(viewingRecentThread.id, viewingRecentThread.thread_type),\n          children: \"\\uD574\\uB2F9 \\uB300\\uD654\\uB85C \\uC774\\uB3D9\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 713,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 709,\n        columnNumber: 13\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          height: '81px',\n          borderBottom: '1px solid #ddd',\n          background: 'white'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 718,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(ChatContent, {\n        ref: chatContentRef,\n        children: isRecentThreadLoading ? /*#__PURE__*/_jsxDEV(LoadingMessage, {\n          personaName: \"AI\",\n          personaColor: \"#666\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 725,\n          columnNumber: 15\n        }, this) : viewingRecentThread ? viewingRecentThread.messages.map((message, index) => /*#__PURE__*/_jsxDEV(Message, {\n          message: {\n            ...message,\n            persona_id: message.role === 'assistant' ? viewingRecentThread.persona_id : undefined,\n            persona_name: message.role === 'assistant' ? viewingRecentThread.persona_name : undefined\n          },\n          personas: personas,\n          showActionButtons: false\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 728,\n          columnNumber: 17\n        }, this)) : /*#__PURE__*/_jsxDEV(EmptyState, {\n          children: [/*#__PURE__*/_jsxDEV(EmptyStateTitle, {\n            children: \"\\uB300\\uD654\\uB97C \\uC120\\uD0DD\\uD574\\uC8FC\\uC138\\uC694\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 741,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(EmptyStateText, {\n            children: \"\\uC67C\\uCABD \\uC0AC\\uC774\\uB4DC\\uBC14\\uC5D0\\uC11C \\uBCF4\\uACE0 \\uC2F6\\uC740 \\uB300\\uD654\\uB97C \\uD074\\uB9AD\\uD558\\uC138\\uC694.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 742,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 740,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 723,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(MessageInput, {\n        onSendMessage: async () => false,\n        disabled: true,\n        placeholder: \"\\uC774 \\uB300\\uD654\\uB294 \\uC77D\\uAE30 \\uC804\\uC6A9\\uC785\\uB2C8\\uB2E4. \\uB300\\uD654\\uB97C \\uC774\\uC5B4\\uAC00\\uB824\\uBA74 '\\uD574\\uB2F9 \\uB300\\uD654\\uB85C \\uC774\\uB3D9' \\uBC84\\uD2BC\\uC744 \\uD074\\uB9AD\\uD558\\uC138\\uC694.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 747,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true) : selectedPersonaItem === 'training' ? /*#__PURE__*/_jsxDEV(TrainingCategoryView, {\n      personas: personas,\n      onSelectPersona: onSelectPersona || (() => {}),\n      onInterpretationComplete: onInterpretationComplete\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 754,\n      columnNumber: 9\n    }, this) : selectedPersonaItem === 'verbalization' ?\n    /*#__PURE__*/\n    // 언어화 모드일 때 VerbalizationView 표시\n    _jsxDEV(VerbalizationView, {\n      selectedThread: (verbalizationProps === null || verbalizationProps === void 0 ? void 0 : verbalizationProps.selectedThread) || null,\n      threads: (verbalizationProps === null || verbalizationProps === void 0 ? void 0 : verbalizationProps.threads) || [],\n      onThreadUpdate: (verbalizationProps === null || verbalizationProps === void 0 ? void 0 : verbalizationProps.onThreadUpdate) || (() => {}),\n      onCreateNewThread: (verbalizationProps === null || verbalizationProps === void 0 ? void 0 : verbalizationProps.onCreateNewThread) || (async () => {})\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 761,\n      columnNumber: 9\n    }, this) : selectedPersonaItem === 'admin' ? /*#__PURE__*/_jsxDEV(PersonaAdminPanel, {\n      onClose: () => {\n        // 관리 모드 종료 시 PersonaSidebar로 돌아가기\n        if (onSelectPersona) {\n          onSelectPersona(''); // 빈 값으로 설정하여 PersonaSidebar의 selectedItem을 null로 만듦\n        }\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 768,\n      columnNumber: 9\n    }, this) : currentInterpretation && (selectedConversationItem === 'proceed' || selectedConversationItem !== null && selectedConversationItem !== void 0 && selectedConversationItem.startsWith('proceed-thread-')) ?\n    // 나아가기 모드일 때 ProceedView 사용\n    renderProceedView() : currentInterpretation && (selectedConversationItem === 'sentence' || selectedConversationItem !== null && selectedConversationItem !== void 0 && selectedConversationItem.startsWith('sentence-thread-')) ?\n    // 문장 모드일 때 SentenceView 사용\n    renderSentenceView() : currentInterpretation && (selectedConversationItem === 'interpretation' || selectedConversationItem !== null && selectedConversationItem !== void 0 && selectedConversationItem.startsWith('interpretation-thread-')) ?\n    // 해석 모드일 때 InterpretationView 사용\n    renderInterpretationView() : currentInterpretation && selectedConversationItem === 'interaction_history' ?\n    // 상호작용 기록 모드일 때 InteractionHistoryView 사용\n    renderInteractionHistoryView() : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(ChatContent, {\n        ref: chatContentRef,\n        children: [!selectedConversation && !currentInterpretation && globalMessages.length === 0 && renderEmptyState(), !selectedConversation && !currentInterpretation && globalMessages.length > 0 && renderInitialResponses(), selectedConversation && renderConversation(), isLoading && (selectedConversation && currentConversation ? /*#__PURE__*/_jsxDEV(LoadingMessage, {\n          personaName: (_personas$currentConv = personas[currentConversation.persona_id]) === null || _personas$currentConv === void 0 ? void 0 : _personas$currentConv.name,\n          personaColor: (_personas$currentConv2 = personas[currentConversation.persona_id]) === null || _personas$currentConv2 === void 0 ? void 0 : _personas$currentConv2.color\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 803,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(LoadingMessage, {\n          personaName: \"AI\",\n          personaColor: \"#666\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 808,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 790,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(MessageInput, {\n        onSendMessage: handleSendMessage,\n        disabled: isLoading || Object.keys(personas).length === 0,\n        placeholder: selectedConversation && currentConversation ? `${(_personas$currentConv3 = personas[currentConversation.persona_id]) === null || _personas$currentConv3 === void 0 ? void 0 : _personas$currentConv3.name}에게 메시지를 보내세요...` : \"모든 페르소나에게 질문해보세요...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 816,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 705,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatArea, \"ZpaVkbWLJKttFKo6G/JtUbnr7cQ=\");\n_c4 = ChatArea;\nexport default ChatArea;\nvar _c, _c2, _c3, _c4;\n$RefreshReg$(_c, \"RecentInteractionHeader\");\n$RefreshReg$(_c2, \"RecentInteractionTitle\");\n$RefreshReg$(_c3, \"NavigateButton\");\n$RefreshReg$(_c4, \"ChatArea\");","map":{"version":3,"names":["React","useEffect","useRef","useState","styled","Message","MessageInput","TrainingCategoryView","InterpretationView","ProceedView","SentenceView","PersonaAdminPanel","LoadingMessage","chatApi","MainArea","ChatContent","EmptyState","EmptyStateTitle","EmptyStateText","InteractionHistoryView","VerbalizationView","jsxDEV","_jsxDEV","Fragment","_Fragment","getThreadTypeLabel","type","RecentInteractionHeader","div","_c","RecentInteractionTitle","h2","_c2","NavigateButton","button","_c3","ChatArea","selectedConversation","conversations","personas","globalMessages","isLoading","error","onSendInitialMessage","onContinueConversation","onClearError","selectedPersonaItem","onSelectPersona","onInterpretationComplete","selectedConversationItem","currentInterpretation","onInterpretationMessage","onUpdateInterpretation","onUpdateConversation","onSwitchConversationMode","onRefreshConversationSidebar","recentInteractionsProps","verbalizationProps","viewingRecentThread","isRecentThreadLoading","onNavigateToThread","_s","_personas$currentConv","_personas$currentConv2","_personas$currentConv3","chatContentRef","currentConversation","editingMessageIndex","setEditingMessageIndex","threads","setThreads","proceedContent","setProceedContent","sentenceContent","setSentenceContent","interactionRecords","setInteractionRecords","current","scrollTop","scrollHeight","messages","loadTrainingData","personaId","threadsResponse","getPersonaThreads","data","proceedThread","find","t","thread_type","sentenceThread","length","firstProceedMessage","m","role","content","firstSentenceMessage","console","loadInteractionRecords","recordsResponse","getAllInteractionRecords","handleSendMessage","message","success","log","handleEditInterpretationMessage","messageIndex","newContent","updatedMessages","timestamp","Date","toISOString","filteredMessages","slice","response","chatWithInterpretation","aiResponse","updatedInterpretation","personaName","apiError","handleEditConversationMessage","_result$data","result","editMessage","updated_conversation","renderInitialResponses","latestMessage","children","user_message","showActionButtons","fileName","_jsxFileName","lineNumber","columnNumber","responses","map","persona_id","persona_name","id","style","margin","padding","backgroundColor","borderRadius","border","textAlign","fontSize","color","marginBottom","renderConversation","index","onCopy","navigator","clipboard","writeText","onEdit","undefined","onEditSave","onEditCancel","isEditing","onSunAction","onPersonAction","onDocumentAction","renderEmptyState","Object","keys","handleSwitchToMode","mode","handleGenerateNewInterpretation","getSelectedThread","conversationItem","includes","threadId","split","thread","handleRefreshThreads","updatedThreads","interpretationResponse","getInterpretation","interpretation","substring","interpretationError","warn","interactionResponse","interactionError","renderInterpretationView","_selectedThread","isInterpretationThread","startsWith","selectedThread","messagesToShow","interpretationContent","selectedThreadId","messageCount","contentPreview","onSendMessage","onEditMessage","onGenerateNewInterpretation","onSwitchToMode","onRefreshThreads","renderProceedView","renderSentenceView","renderInteractionHistoryView","allInteractionRecords","onThreadSelect","handleInteractionThreadSelect","onClick","height","borderBottom","background","ref","personaColor","disabled","placeholder","onThreadUpdate","onCreateNewThread","onClose","name","_c4","$RefreshReg$"],"sources":["C:/Users/sungh/Desktop/chat_work_ver3/frontend/src/features/shared/components/ChatArea.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { Conversation, Persona, GlobalMessage, TrainingThread, InteractionRecord } from '../types';\nimport Message from './Message';\nimport MessageInput from './MessageInput';\nimport TrainingCategoryView from '../../training/components/TrainingCategoryView';\nimport InterpretationView from '../../training/components/InterpretationView';\nimport ProceedView from '../../training/components/ProceedView';\nimport SentenceView from '../../training/components/SentenceView';\nimport ConfusionView from '../../training/components/ConfusionView';\nimport PersonaAdminPanel from '../../admin/components/PersonaAdminPanel';\nimport LoadingMessage from './LoadingMessage';\nimport { chatApi } from '../api/chatApi';\nimport {\n  MainArea,\n  ChatContent,\n  EmptyState,\n  EmptyStateTitle,\n  EmptyStateText,\n} from '../styles/GlobalStyle';\nimport InteractionHistoryView from '../../training/components/InteractionHistoryView';\nimport VerbalizationView from '../../verbalization/components/VerbalizationView';\n\n// Helper and styled components from RecentInteractionsView\nconst getThreadTypeLabel = (type: string) => {\n  switch (type) {\n    case 'interpretation': return '해석';\n    case 'proceed': return '나아가기';\n    case 'sentence': return '문장';\n    case 'verbalization': return '언어화';\n    default: return type;\n  }\n};\n\nconst RecentInteractionHeader = styled.div`\n  padding: 20px;\n  border-bottom: 1px solid #e0e0e0;\n  background: #f8f9fa;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  height: 81px;\n  box-sizing: border-box;\n`;\n\nconst RecentInteractionTitle = styled.h2`\n  font-size: 24px;\n  font-weight: 600;\n  color: #333;\n  margin: 0;\n`;\n\nconst NavigateButton = styled.button`\n  padding: 10px 20px;\n  background: linear-gradient(90deg, #ffffff 0%, #f0f0f0 100%);\n  border: 1px solid #ccc;\n  border-radius: 12px;\n  color: #333;\n  font-size: 14px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  \n  &:hover {\n    background: linear-gradient(90deg, #f8f8f8 0%, #e8e8e8 100%);\n    transform: translateY(-1px);\n    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);\n  }\n  \n  &:active {\n    transform: translateY(0);\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  }\n`;\n\n\ninterface ChatAreaProps {\n  selectedConversation: string | null;\n  conversations: Record<string, Conversation>;\n  personas: Record<string, Persona>;\n  globalMessages: GlobalMessage[];\n  isLoading: boolean;\n  error: string | null;\n  onSendInitialMessage: (message: string) => Promise<boolean>;\n  onContinueConversation: (conversationId: string, message: string) => Promise<boolean>;\n  onClearError: () => void;\n  selectedPersonaItem?: string | null; // 훈습 모드 확인용\n  onSelectPersona?: (personaId: string) => void; // 페르소나 선택 핸들러\n  onInterpretationComplete: (personaId: string, interpretation: string) => void; // 해석 완료 핸들러\n  selectedConversationItem?: string | null; // 선택된 대화 항목\n  currentInterpretation?: {\n    personaId: string;\n    personaName: string;\n    content: string;\n    messages: Array<{\n      role: 'user' | 'assistant';\n      content: string;\n      timestamp: string;\n    }>;\n  } | null;\n  onInterpretationMessage: (message: string) => Promise<boolean>; // 해석 채팅 메시지 핸들러\n  onUpdateInterpretation?: (updatedInterpretation: {\n    personaId: string;\n    personaName: string;\n    content: string;\n    messages: Array<{\n      role: 'user' | 'assistant';\n      content: string;\n      timestamp: string;\n    }>;\n  }) => void; // 해석 업데이트 핸들러\n  onUpdateConversation?: (updatedConversation: any) => void; // 대화 업데이트 핸들러\n  onSwitchConversationMode?: (mode: string) => void; // 대화 모드 전환 핸들러\n  onRefreshConversationSidebar?: () => void; // ConversationSidebar 새로고침 핸들러\n  viewingRecentThread?: (TrainingThread & { persona_id: string; persona_name: string; }) | null;\n  isRecentThreadLoading?: boolean;\n  onNavigateToThread?: (threadId: string, threadType: string, interactionMessage?: string) => void;\n  recentInteractionsProps?: {\n    personas: Record<string, Persona>;\n    onSelectPersona: (personaId: string) => void;\n    onThreadSelect: (thread: TrainingThread, personaId: string) => void;\n  }; // 최근 상호작용 관련 props\n  verbalizationProps?: {\n    selectedThread: TrainingThread | null;\n    threads: TrainingThread[];\n    onThreadUpdate: () => void;\n    onCreateNewThread: () => Promise<void>;\n  }; // 언어화 관련 props\n}\n\nconst ChatArea: React.FC<ChatAreaProps> = ({\n  selectedConversation,\n  conversations,\n  personas,\n  globalMessages,\n  isLoading,\n  error,\n  onSendInitialMessage,\n  onContinueConversation,\n  onClearError,\n  selectedPersonaItem,\n  onSelectPersona,\n  onInterpretationComplete,\n  selectedConversationItem,\n  currentInterpretation,\n  onInterpretationMessage,\n  onUpdateInterpretation,\n  onUpdateConversation,\n  onSwitchConversationMode,\n  onRefreshConversationSidebar,\n  recentInteractionsProps,\n  verbalizationProps,\n  viewingRecentThread,\n  isRecentThreadLoading,\n  onNavigateToThread,\n}) => {\n  const chatContentRef = useRef<HTMLDivElement>(null);\n  const currentConversation = selectedConversation ? conversations[selectedConversation] : null;\n  \n  // 편집 상태 관리\n  const [editingMessageIndex, setEditingMessageIndex] = useState<number | null>(null);\n  \n  // 훈습 관련 상태\n  const [threads, setThreads] = useState<TrainingThread[]>([]);\n  const [proceedContent, setProceedContent] = useState<string>('');\n  const [sentenceContent, setSentenceContent] = useState<string>('');\n  const [interactionRecords, setInteractionRecords] = useState<InteractionRecord[]>([]);\n\n  // 메시지가 추가될 때마다 스크롤을 맨 아래로\n  useEffect(() => {\n    if (chatContentRef.current) {\n      chatContentRef.current.scrollTop = chatContentRef.current.scrollHeight;\n    }\n  }, [currentConversation?.messages, globalMessages, isLoading]);\n\n  // 훈습 데이터 로딩을 더 정확하게 수정\n  useEffect(() => {\n    const loadTrainingData = async () => {\n      if (!currentInterpretation?.personaId) return;\n\n      try {\n        // 스레드 데이터 로드\n        const threadsResponse = await chatApi.getPersonaThreads(currentInterpretation.personaId);\n        if (threadsResponse.data) {\n          setThreads(threadsResponse.data);\n          \n          // 나아가기와 문장 스레드에서 콘텐츠 추출\n          const proceedThread = threadsResponse.data.find(t => t.thread_type === 'proceed');\n          const sentenceThread = threadsResponse.data.find(t => t.thread_type === 'sentence');\n          \n          if (proceedThread && proceedThread.messages.length > 0) {\n            const firstProceedMessage = proceedThread.messages.find(m => m.role === 'assistant');\n            if (firstProceedMessage) {\n              setProceedContent(firstProceedMessage.content);\n            }\n          }\n          \n          if (sentenceThread && sentenceThread.messages.length > 0) {\n            const firstSentenceMessage = sentenceThread.messages.find(m => m.role === 'assistant');\n            if (firstSentenceMessage) {\n              setSentenceContent(firstSentenceMessage.content);\n            }\n          }\n        }\n      } catch (error) {\n        console.error('훈습 데이터 로드 실패:', error);\n      }\n    };\n\n    loadTrainingData();\n  }, [currentInterpretation?.personaId]);\n\n  // 스레드 업데이트 시 콘텐츠도 업데이트\n  useEffect(() => {\n    const proceedThread = threads.find(t => t.thread_type === 'proceed');\n    const sentenceThread = threads.find(t => t.thread_type === 'sentence');\n    \n    if (proceedThread && proceedThread.messages.length > 0) {\n      const firstProceedMessage = proceedThread.messages.find(m => m.role === 'assistant');\n      if (firstProceedMessage) {\n        setProceedContent(firstProceedMessage.content);\n      }\n    }\n    \n    if (sentenceThread && sentenceThread.messages.length > 0) {\n      const firstSentenceMessage = sentenceThread.messages.find(m => m.role === 'assistant');\n      if (firstSentenceMessage) {\n        setSentenceContent(firstSentenceMessage.content);\n      }\n    }\n  }, [threads]);\n\n  // 상호작용 기록 로드\n  useEffect(() => {\n    const loadInteractionRecords = async () => {\n      try {\n        const recordsResponse = await chatApi.getAllInteractionRecords();\n        if (recordsResponse.data) {\n          setInteractionRecords(recordsResponse.data);\n        }\n      } catch (error) {\n        console.error('상호작용 기록 로드 실패:', error);\n      }\n    };\n\n    loadInteractionRecords();\n  }, [currentInterpretation, threads]); // threads나 currentInterpretation이 변경될 때마다 새로고침\n\n  const handleSendMessage = async (message: string) => {\n    let success = false;\n    if (selectedConversation) {\n      // 기존 대화에 메시지 추가\n      success = await onContinueConversation(selectedConversation, message);\n    } else if (currentInterpretation) {\n      // 해석 모드에서는 해석 관련 메시지 전송\n      success = await onInterpretationMessage(message);\n    } else {\n      // 새로운 대화 시작\n      success = await onSendInitialMessage(message);\n    }\n\n    if (success && onRefreshConversationSidebar) {\n      console.log('메시지 전송 성공, ConversationSidebar 새로고침 실행');\n      onRefreshConversationSidebar();\n    }\n    \n    return success;\n  };\n\n  // 해석 메시지 수정 핸들러\n  const handleEditInterpretationMessage = async (messageIndex: number, newContent: string): Promise<boolean> => {\n    if (!currentInterpretation) return false;\n\n    try {\n      // 메시지 수정 - 수정 후 새로운 응답 자동 생성\n      const updatedMessages = [...currentInterpretation.messages];\n      if (messageIndex >= 0 && messageIndex < updatedMessages.length) {\n        // 수정된 메시지 업데이트\n        updatedMessages[messageIndex] = {\n          ...updatedMessages[messageIndex],\n          content: newContent,\n          timestamp: new Date().toISOString(),\n        };\n\n        // 수정된 메시지 이후의 모든 메시지들 제거\n        const filteredMessages = updatedMessages.slice(0, messageIndex + 1);\n\n        // 백엔드 API를 통해 새로운 AI 응답 생성\n        try {\n          const response = await chatApi.chatWithInterpretation(\n            currentInterpretation.personaId,\n            newContent\n          );\n\n          if (response.data) {\n            const aiResponse = {\n              role: 'assistant' as const,\n              content: response.data.response,\n              timestamp: response.data.timestamp,\n            };\n\n            const updatedInterpretation = {\n              ...currentInterpretation,\n              messages: [...filteredMessages, aiResponse],\n            };\n\n            // 상위 컴포넌트에 업데이트 알림\n            if (onUpdateInterpretation) {\n              onUpdateInterpretation(updatedInterpretation);\n            }\n\n            return true;\n          } else {\n            // API 호출 실패 시 로컬에서 임시 응답 생성\n            const aiResponse = {\n              role: 'assistant' as const,\n              content: `${currentInterpretation.personaName}의 관점에서 수정된 메시지에 대해 새롭게 응답드리겠습니다.\\n\\n\"${newContent}\"에 대해 분석해보면, 이는 이전과는 다른 맥락을 제시하고 있습니다. 수정된 내용을 바탕으로 새로운 해석과 통찰을 제공하겠습니다.`,\n              timestamp: new Date().toISOString(),\n            };\n\n            const updatedInterpretation = {\n              ...currentInterpretation,\n              messages: [...filteredMessages, aiResponse],\n            };\n\n            if (onUpdateInterpretation) {\n              onUpdateInterpretation(updatedInterpretation);\n            }\n\n            return true;\n          }\n        } catch (apiError) {\n          console.error('해석 API 호출 실패:', apiError);\n          \n          // API 호출 실패 시 로컬에서 임시 응답 생성\n          const aiResponse = {\n            role: 'assistant' as const,\n            content: `${currentInterpretation.personaName}의 관점에서 수정된 메시지에 대해 새롭게 응답드리겠습니다.\\n\\n\"${newContent}\"에 대해 분석해보면, 이는 이전과는 다른 맥락을 제시하고 있습니다. 수정된 내용을 바탕으로 새로운 해석과 통찰을 제공하겠습니다.`,\n            timestamp: new Date().toISOString(),\n          };\n\n          const updatedInterpretation = {\n            ...currentInterpretation,\n            messages: [...filteredMessages, aiResponse],\n          };\n\n          if (onUpdateInterpretation) {\n            onUpdateInterpretation(updatedInterpretation);\n          }\n\n          return true;\n        }\n      }\n      return false;\n    } catch (error) {\n      console.error('해석 메시지 수정 실패:', error);\n      return false;\n    }\n  };\n\n  // 일반 대화 메시지 수정 핸들러\n  const handleEditConversationMessage = async (messageIndex: number, newContent: string): Promise<boolean> => {\n    if (!selectedConversation || !currentConversation) return false;\n\n    try {\n      const result = await chatApi.editMessage(selectedConversation, messageIndex, newContent);\n      \n      if (result.data?.success && result.data.updated_conversation) {\n        // 수정된 대화 정보로 즉시 UI 업데이트\n        if (onUpdateConversation) {\n          onUpdateConversation(result.data.updated_conversation);\n        }\n        \n        return true;\n      } else {\n        console.error('메시지 수정 실패:', result.error);\n        return false;\n      }\n    } catch (error) {\n      console.error('메시지 수정 요청 실패:', error);\n      return false;\n    }\n  };\n\n\n\n  const renderInitialResponses = () => {\n    if (!globalMessages.length) return null;\n    \n    const latestMessage = globalMessages[globalMessages.length - 1];\n    \n    return (\n      <div>\n        {/* 사용자 질문 */}\n        <Message\n          message={{\n            role: 'user',\n            content: latestMessage.user_message,\n            timestamp: latestMessage.timestamp,\n          }}\n          personas={personas}\n          showActionButtons={false}\n        />\n        \n        {/* 모든 페르소나 응답 */}\n        {latestMessage.responses.map((response) => (\n          <Message\n            key={`${latestMessage.id}_${response.persona_id}`}\n            message={{\n              role: 'assistant',\n              content: response.content,\n              timestamp: response.timestamp,\n              persona_id: response.persona_id,\n              persona_name: response.persona_name,\n            }}\n            personas={personas}\n            showActionButtons={true}\n          />\n        ))}\n        \n        <div style={{\n          margin: '20px 0',\n          padding: '16px',\n          backgroundColor: '#f8f8f8',\n          borderRadius: '8px',\n          border: 'none',\n          textAlign: 'center',\n        }}>\n          <div style={{ fontSize: '14px', color: '#666', marginBottom: '8px' }}>\n            💡 각 페르소나와 개별적으로 대화를 이어가려면\n          </div>\n          <div style={{ fontSize: '13px', color: '#888' }}>\n            왼쪽 사이드바에서 페르소나를 선택하거나, 특정 대화를 선택하세요\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  const renderConversation = () => {\n    if (!currentConversation) return null;\n\n    return currentConversation.messages.map((message, index) => (\n      <Message\n        key={`${currentConversation.id}_${index}`}\n        message={message}\n        personas={personas}\n        showActionButtons={true}\n        onCopy={() => {\n          navigator.clipboard.writeText(message.content);\n        }}\n        onEdit={message.role === 'user' ? () => setEditingMessageIndex(index) : undefined}\n        onEditSave={message.role === 'user' ? async (newContent) => {\n          const success = await handleEditConversationMessage(index, newContent);\n                  if (success) {\n          setEditingMessageIndex(null);\n        }\n          return success;\n        } : undefined}\n        onEditCancel={() => setEditingMessageIndex(null)}\n        isEditing={editingMessageIndex === index}\n        onSunAction={() => {}}\n        onPersonAction={() => {}}\n        onDocumentAction={() => {}}\n      />\n    ));\n  };\n\n  const renderEmptyState = () => (\n    <EmptyState>\n      <EmptyStateTitle>새로운 대화를 시작해보세요!</EmptyStateTitle>\n      <EmptyStateText>\n        {Object.keys(personas).length > 0 ? (\n          <>\n            아래에 질문을 입력하면 {Object.keys(personas).length}개의 페르소나가<br />\n            각각 다른 관점에서 답변해드립니다.\n          </>\n        ) : (\n          '페르소나 정보를 불러오는 중입니다...'\n        )}\n      </EmptyStateText>\n    </EmptyState>\n  );\n\n  // 모드 전환 핸들러\n  const handleSwitchToMode = (mode: 'interpretation' | 'proceed' | 'sentence') => {\n    if (onSwitchConversationMode) {\n      onSwitchConversationMode(mode);\n    }\n  };\n\n  // 새로운 해석 생성 핸들러\n  const handleGenerateNewInterpretation = async () => {\n    if (!currentInterpretation?.personaId) return;\n    \n    try {\n      // 새로운 해석을 생성하고 완료 콜백 호출\n      onInterpretationComplete(currentInterpretation.personaId, '새로운 해석을 생성합니다...');\n    } catch (error) {\n      console.error('새로운 해석 생성 실패:', error);\n    }\n  };\n\n  // 선택된 스레드 추출\n  const getSelectedThread = (conversationItem: string | null | undefined): TrainingThread | null => {\n    if (!conversationItem || !conversationItem.includes('-thread-')) return null;\n    \n    const threadId = conversationItem.split('-thread-')[1];\n    return threads.find(thread => thread.id === threadId) || null;\n  };\n\n  // 스레드 새로고침 함수\n  const handleRefreshThreads = async () => {\n    if (!currentInterpretation?.personaId) return;\n    \n    try {\n      console.log('=== 스레드 새로고침 시작 ===');\n      console.log('personaId:', currentInterpretation.personaId);\n      \n      // 1. 스레드 정보 새로고침\n      const threadsResponse = await chatApi.getPersonaThreads(currentInterpretation.personaId);\n      if (threadsResponse.data) {\n        const updatedThreads = threadsResponse.data;\n        setThreads(updatedThreads);\n        console.log('스레드 업데이트 완료:', updatedThreads.length, '개');\n        \n        // 콘텐츠 업데이트\n        const proceedThread = updatedThreads.find(t => t.thread_type === 'proceed');\n        const sentenceThread = updatedThreads.find(t => t.thread_type === 'sentence');\n        \n        if (proceedThread && proceedThread.messages.length > 0) {\n          const firstProceedMessage = proceedThread.messages.find(m => m.role === 'assistant');\n          if (firstProceedMessage) {\n            setProceedContent(firstProceedMessage.content);\n          }\n        }\n        \n        if (sentenceThread && sentenceThread.messages.length > 0) {\n          const firstSentenceMessage = sentenceThread.messages.find(m => m.role === 'assistant');\n          if (firstSentenceMessage) {\n            setSentenceContent(firstSentenceMessage.content);\n          }\n        }\n      }\n      \n      // 2. 해석 내용도 새로고침 (중요!)\n      try {\n        console.log('해석 내용 새로고침 시작...');\n        const interpretationResponse = await chatApi.getInterpretation(currentInterpretation.personaId);\n        if (interpretationResponse.data) {\n          console.log('해석 내용 업데이트:', interpretationResponse.data.interpretation.substring(0, 100) + '...');\n          \n          // 해석 내용 업데이트\n          const updatedInterpretation = {\n            ...currentInterpretation,\n            content: interpretationResponse.data.interpretation,\n          };\n          \n          if (onUpdateInterpretation) {\n            onUpdateInterpretation(updatedInterpretation);\n            console.log('해석 내용 업데이트 완료');\n          }\n        }\n      } catch (interpretationError) {\n        console.warn('해석 내용 새로고침 실패:', interpretationError);\n      }\n      \n      // 3. 상호작용 기록도 새로고침 (해석 저장이 반영되도록)\n      try {\n        console.log('상호작용 기록 새로고침 시작...');\n        const interactionResponse = await chatApi.getAllInteractionRecords();\n        if (interactionResponse.data) {\n          setInteractionRecords(interactionResponse.data);\n          console.log('상호작용 기록 업데이트 완료:', interactionResponse.data.length, '개');\n        }\n      } catch (interactionError) {\n        console.warn('상호작용 기록 새로고침 실패:', interactionError);\n      }\n      \n      // 4. ConversationSidebar 새로고침\n      if (onRefreshConversationSidebar) {\n        console.log('ConversationSidebar 새로고침 트리거...');\n        onRefreshConversationSidebar();\n      }\n      \n      console.log('=== 스레드 새로고침 완료 ===');\n    } catch (error) {\n      console.error('스레드 새로고침 실패:', error);\n    }\n  };\n\n  // 해석 뷰 렌더링\n  const renderInterpretationView = () => {\n    if (!currentInterpretation) return null;\n\n    // 해석 스레드가 명시적으로 선택된 경우에만 해당 스레드의 데이터 사용\n    const isInterpretationThread = selectedConversationItem?.startsWith('interpretation-thread-');\n    let selectedThread = null;\n    \n    if (isInterpretationThread) {\n      selectedThread = getSelectedThread(selectedConversationItem);\n    }\n    \n    // 사용할 메시지들 결정: 명시적으로 해석 스레드가 선택된 경우에만 스레드 메시지 사용\n    const messagesToShow = isInterpretationThread && selectedThread \n      ? selectedThread.messages \n      : currentInterpretation.messages;\n    \n    // 사용할 해석 내용 결정: 명시적으로 해석 스레드가 선택된 경우에만 스레드 content 사용\n    const interpretationContent = isInterpretationThread && selectedThread \n      ? (selectedThread.content || (selectedThread.messages.length > 0 ? selectedThread.messages[0].content : currentInterpretation.content))\n      : currentInterpretation.content;\n\n    console.log('해석 뷰 렌더링:', {\n      isInterpretationThread,\n      selectedThreadId: selectedThread?.id,\n      selectedConversationItem,\n      messageCount: messagesToShow.length,\n      contentPreview: interpretationContent.substring(0, 100) + '...'\n    });\n\n    return (\n      <InterpretationView\n        interpretation={interpretationContent}\n        personaName={currentInterpretation.personaName}\n        onSendMessage={onInterpretationMessage}\n        onEditMessage={handleEditInterpretationMessage}\n        isLoading={isLoading}\n        messages={messagesToShow}\n        onGenerateNewInterpretation={handleGenerateNewInterpretation}\n        onSwitchToMode={handleSwitchToMode}\n        personaId={currentInterpretation.personaId}\n        onRefreshThreads={handleRefreshThreads}\n        selectedThread={selectedThread}\n      />\n    );\n  };\n\n  // 나아가기 뷰 렌더링\n  const renderProceedView = () => {\n    if (!currentInterpretation) return null;\n\n    const selectedThread = getSelectedThread(selectedConversationItem);\n\n    return (\n      <ProceedView\n        personaId={currentInterpretation.personaId}\n        personaName={currentInterpretation.personaName}\n        proceedContent={proceedContent || '나아가기를 생성하고 있습니다...'}\n        threads={threads}\n        onSwitchToMode={handleSwitchToMode}\n        onGenerateNewInterpretation={handleGenerateNewInterpretation}\n        selectedThread={selectedThread}\n        onRefreshThreads={handleRefreshThreads}\n      />\n    );\n  };\n\n  // 문장 뷰 렌더링\n  const renderSentenceView = () => {\n    if (!currentInterpretation) return null;\n\n    const selectedThread = getSelectedThread(selectedConversationItem);\n\n    return (\n      <SentenceView\n        personaId={currentInterpretation.personaId}\n        personaName={currentInterpretation.personaName}\n        sentenceContent={sentenceContent || '문장을 생성하고 있습니다...'}\n        threads={threads}\n        onSwitchToMode={handleSwitchToMode}\n        onGenerateNewInterpretation={handleGenerateNewInterpretation}\n        selectedThread={selectedThread}\n        onRefreshThreads={handleRefreshThreads}\n      />\n    );\n  };\n\n  // 상호작용 기록 뷰 렌더링\n  const renderInteractionHistoryView = () => {\n    if (!currentInterpretation) return null;\n\n    return (\n      <InteractionHistoryView\n        personaId={currentInterpretation.personaId}\n        personaName={currentInterpretation.personaName}\n        allInteractionRecords={interactionRecords}\n        onThreadSelect={handleInteractionThreadSelect}\n        onSwitchToMode={handleSwitchToMode}\n        onGenerateNewInterpretation={handleGenerateNewInterpretation}\n      />\n    );\n  };\n\n  // 상호작용 기록에서 스레드 선택 핸들러\n  const handleInteractionThreadSelect = (thread: TrainingThread) => {\n    // 해당 스레드의 모드로 전환하고 스레드 선택\n    if (onSwitchConversationMode) {\n      onSwitchConversationMode(`${thread.thread_type}-thread-${thread.id}`);\n    }\n  };\n\n  return (\n    <MainArea>\n      {selectedPersonaItem === 'recent' ? (\n        <>\n          {viewingRecentThread ? (\n            <RecentInteractionHeader>\n              <RecentInteractionTitle>\n                {`${viewingRecentThread.persona_name} - ${getThreadTypeLabel(viewingRecentThread.thread_type)}`}\n              </RecentInteractionTitle>\n              <NavigateButton onClick={() => onNavigateToThread?.(viewingRecentThread.id, viewingRecentThread.thread_type)}>\n                해당 대화로 이동\n              </NavigateButton>\n            </RecentInteractionHeader>\n          ) : (\n            <div style={{ height: '81px', borderBottom: '1px solid #ddd', background: 'white' }}>\n              {/* Empty header to match height */}\n          </div>\n          )}\n\n          <ChatContent ref={chatContentRef}>\n            {isRecentThreadLoading ? (\n              <LoadingMessage personaName=\"AI\" personaColor=\"#666\" />\n            ) : viewingRecentThread ? (\n              viewingRecentThread.messages.map((message, index) => (\n                <Message\n                  key={index}\n                  message={{\n                    ...message,\n                    persona_id: message.role === 'assistant' ? viewingRecentThread.persona_id : undefined,\n                    persona_name: message.role === 'assistant' ? viewingRecentThread.persona_name : undefined,\n                  }}\n                  personas={personas}\n                  showActionButtons={false}\n                />\n              ))\n            ) : (\n              <EmptyState>\n                <EmptyStateTitle>대화를 선택해주세요</EmptyStateTitle>\n                <EmptyStateText>왼쪽 사이드바에서 보고 싶은 대화를 클릭하세요.</EmptyStateText>\n              </EmptyState>\n            )}\n          </ChatContent>\n\n          <MessageInput\n            onSendMessage={async () => false}\n            disabled={true}\n            placeholder=\"이 대화는 읽기 전용입니다. 대화를 이어가려면 '해당 대화로 이동' 버튼을 클릭하세요.\"\n          />\n        </>\n      ) : selectedPersonaItem === 'training' ? (\n        <TrainingCategoryView\n          personas={personas}\n          onSelectPersona={onSelectPersona || (() => {})}\n          onInterpretationComplete={onInterpretationComplete}\n        />\n      ) : selectedPersonaItem === 'verbalization' ? (\n        // 언어화 모드일 때 VerbalizationView 표시\n        <VerbalizationView\n          selectedThread={verbalizationProps?.selectedThread || null}\n          threads={verbalizationProps?.threads || []}\n          onThreadUpdate={verbalizationProps?.onThreadUpdate || (() => {})}\n          onCreateNewThread={verbalizationProps?.onCreateNewThread || (async () => {})}\n        />\n      ) : selectedPersonaItem === 'admin' ? (\n        <PersonaAdminPanel \n          onClose={() => {\n            // 관리 모드 종료 시 PersonaSidebar로 돌아가기\n            if (onSelectPersona) {\n              onSelectPersona(''); // 빈 값으로 설정하여 PersonaSidebar의 selectedItem을 null로 만듦\n            }\n          }}\n        />\n      ) : currentInterpretation && (selectedConversationItem === 'proceed' || selectedConversationItem?.startsWith('proceed-thread-')) ? (\n        // 나아가기 모드일 때 ProceedView 사용\n        renderProceedView()\n      ) : currentInterpretation && (selectedConversationItem === 'sentence' || selectedConversationItem?.startsWith('sentence-thread-')) ? (\n        // 문장 모드일 때 SentenceView 사용\n        renderSentenceView()\n      ) : currentInterpretation && (selectedConversationItem === 'interpretation' || selectedConversationItem?.startsWith('interpretation-thread-')) ? (\n        // 해석 모드일 때 InterpretationView 사용\n        renderInterpretationView()\n      ) : currentInterpretation && selectedConversationItem === 'interaction_history' ? (\n        // 상호작용 기록 모드일 때 InteractionHistoryView 사용\n        renderInteractionHistoryView()\n      ) : (\n        <>\n      <ChatContent ref={chatContentRef}>\n        {/* {error && (\n          <ErrorMessage onClick={onClearError}>\n            {error} (클릭하여 닫기)\n          </ErrorMessage>\n        )} */}\n\n            {!selectedConversation && !currentInterpretation && globalMessages.length === 0 && renderEmptyState()}\n            {!selectedConversation && !currentInterpretation && globalMessages.length > 0 && renderInitialResponses()}\n        {selectedConversation && renderConversation()}\n\n        {isLoading && (\n          selectedConversation && currentConversation ? (\n            <LoadingMessage \n              personaName={personas[currentConversation.persona_id]?.name}\n              personaColor={personas[currentConversation.persona_id]?.color}\n            />\n          ) : (\n            <LoadingMessage \n              personaName=\"AI\"\n              personaColor=\"#666\"\n            />\n          )\n        )}\n      </ChatContent>\n\n      <MessageInput\n        onSendMessage={handleSendMessage}\n        disabled={isLoading || Object.keys(personas).length === 0}\n        placeholder={\n          selectedConversation && currentConversation\n            ? `${personas[currentConversation.persona_id]?.name}에게 메시지를 보내세요...`\n            : \"모든 페르소나에게 질문해보세요...\"\n        }\n      />\n        </>\n      )}\n    </MainArea>\n  );\n};\n\nexport default ChatArea; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}