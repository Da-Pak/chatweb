{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\sungh\\\\Desktop\\\\chat_work_ver2\\\\frontend\\\\src\\\\features\\\\training\\\\components\\\\InterpretationView.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { chatApi } from '../../shared/api/chatApi';\nimport Message from '../../shared/components/Message';\nimport { ViewContainer, ChatContainer, InputContainer, StyledTextArea, SendButton, LoadingText } from '../../shared/styles/GlobalStyle';\nimport { showCopyToast } from '../../shared/utils/toastHelper';\nimport { ActionButton, ActionsContainer } from './shared/InteractionView.styles';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst InterpretationView = ({\n  personaId,\n  personaName,\n  selectedThread,\n  onRefreshThreads,\n  onSwitchToMode,\n  onGenerateNewInterpretation\n}) => {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const chatContainerRef = useRef(null);\n  useEffect(() => {\n    if (selectedThread) {\n      setMessages(selectedThread.messages || []);\n    }\n  }, [selectedThread]);\n  useEffect(() => {\n    if (chatContainerRef.current) {\n      chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\n    }\n  }, [messages]);\n  const handleSendMessage = async () => {\n    if (!newMessage.trim() || !selectedThread) return;\n    const userMessage = {\n      role: 'user',\n      content: newMessage,\n      timestamp: new Date().toISOString()\n    };\n    setIsLoading(true);\n    setMessages(prev => [...prev, userMessage]);\n    setNewMessage('');\n    try {\n      const result = await chatApi.chatWithThread({\n        thread_id: selectedThread.id,\n        user_message: newMessage\n      });\n      if (result.data) {\n        setMessages(prev => [...prev.slice(0, -1), userMessage, result.data.response]);\n        if (onRefreshThreads) {\n          onRefreshThreads();\n        }\n      } else {\n        console.error('Message sending failed:', result.error);\n        setMessages(prev => prev.slice(0, -1)); // 실패 시 사용자 메시지 제거\n        showCopyToast('메시지 전송에 실패했습니다.');\n      }\n    } catch (error) {\n      console.error('Error sending message:', error);\n      setMessages(prev => prev.slice(0, -1));\n      showCopyToast('오류가 발생했습니다.');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(ViewContainer, {\n    children: [/*#__PURE__*/_jsxDEV(ActionsContainer, {\n      children: [/*#__PURE__*/_jsxDEV(ActionButton, {\n        onClick: onGenerateNewInterpretation,\n        children: \"\\uC0C8\\uB85C\\uC6B4 \\uD574\\uC11D\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ActionButton, {\n        onClick: () => onSwitchToMode('proceed'),\n        children: \"\\uB098\\uC544\\uAC00\\uAE30\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ActionButton, {\n        onClick: () => onSwitchToMode('sentence'),\n        children: \"\\uBB38\\uC7A5\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ChatContainer, {\n      ref: chatContainerRef,\n      children: [messages.map((msg, index) => /*#__PURE__*/_jsxDEV(Message, {\n        message: msg,\n        personas: {},\n        showActionButtons: false\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 11\n      }, this)), isLoading && /*#__PURE__*/_jsxDEV(LoadingText, {\n        children: \"\\uC751\\uB2F5 \\uC0DD\\uC131 \\uC911...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 23\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(InputContainer, {\n      children: [/*#__PURE__*/_jsxDEV(StyledTextArea, {\n        value: newMessage,\n        onChange: e => setNewMessage(e.target.value),\n        placeholder: selectedThread ? `${personaName}에게 메시지를 보내세요...` : '먼저 해석을 시작해주세요.',\n        disabled: !selectedThread || isLoading,\n        onKeyPress: e => {\n          if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault();\n            handleSendMessage();\n          }\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SendButton, {\n        onClick: handleSendMessage,\n        disabled: !selectedThread || isLoading,\n        children: \"\\uC804\\uC1A1\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 5\n  }, this);\n};\n_s(InterpretationView, \"lmugyRz0rqTfcQzdg/KBwyDrU+E=\");\n_c = InterpretationView;\nexport default InterpretationView;\nvar _c;\n$RefreshReg$(_c, \"InterpretationView\");","map":{"version":3,"names":["React","useState","useEffect","useRef","chatApi","Message","ViewContainer","ChatContainer","InputContainer","StyledTextArea","SendButton","LoadingText","showCopyToast","ActionButton","ActionsContainer","jsxDEV","_jsxDEV","InterpretationView","personaId","personaName","selectedThread","onRefreshThreads","onSwitchToMode","onGenerateNewInterpretation","_s","messages","setMessages","newMessage","setNewMessage","isLoading","setIsLoading","chatContainerRef","current","scrollTop","scrollHeight","handleSendMessage","trim","userMessage","role","content","timestamp","Date","toISOString","prev","result","chatWithThread","thread_id","id","user_message","data","slice","response","console","error","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","ref","map","msg","index","message","personas","showActionButtons","value","onChange","e","target","placeholder","disabled","onKeyPress","key","shiftKey","preventDefault","_c","$RefreshReg$"],"sources":["C:/Users/sungh/Desktop/chat_work_ver2/frontend/src/features/training/components/InterpretationView.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport { chatApi } from '../../shared/api/chatApi';\nimport { Message as MessageType, TrainingThread } from '../../shared/types';\nimport Message from '../../shared/components/Message';\nimport { ViewContainer, ChatContainer, InputContainer, StyledTextArea, SendButton, LoadingText } from '../../shared/styles/GlobalStyle';\nimport { showCopyToast } from '../../shared/utils/toastHelper';\nimport { ActionButton, ActionsContainer } from './shared/InteractionView.styles';\n\ninterface InterpretationViewProps {\n  personaId: string;\n  personaName: string;\n  selectedThread: TrainingThread | null;\n  onRefreshThreads?: () => void;\n  onSwitchToMode: (mode: 'interpretation' | 'proceed' | 'sentence') => void;\n  onGenerateNewInterpretation: () => void;\n}\n\nconst InterpretationView: React.FC<InterpretationViewProps> = ({\n  personaId,\n  personaName,\n  selectedThread,\n  onRefreshThreads,\n  onSwitchToMode,\n  onGenerateNewInterpretation,\n}) => {\n  const [messages, setMessages] = useState<MessageType[]>([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const chatContainerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (selectedThread) {\n      setMessages(selectedThread.messages || []);\n    }\n  }, [selectedThread]);\n\n  useEffect(() => {\n    if (chatContainerRef.current) {\n      chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\n    }\n  }, [messages]);\n\n  const handleSendMessage = async () => {\n    if (!newMessage.trim() || !selectedThread) return;\n\n    const userMessage: MessageType = {\n      role: 'user',\n      content: newMessage,\n      timestamp: new Date().toISOString(),\n    };\n\n    setIsLoading(true);\n    setMessages(prev => [...prev, userMessage]);\n    setNewMessage('');\n\n    try {\n      const result = await chatApi.chatWithThread({\n        thread_id: selectedThread.id,\n        user_message: newMessage,\n      });\n\n      if (result.data) {\n        setMessages(prev => [...prev.slice(0, -1), userMessage, result.data.response]);\n        if (onRefreshThreads) {\n          onRefreshThreads();\n        }\n      } else {\n        console.error('Message sending failed:', result.error);\n        setMessages(prev => prev.slice(0, -1)); // 실패 시 사용자 메시지 제거\n        showCopyToast('메시지 전송에 실패했습니다.');\n      }\n    } catch (error) {\n      console.error('Error sending message:', error);\n      setMessages(prev => prev.slice(0, -1));\n      showCopyToast('오류가 발생했습니다.');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  \n  return (\n    <ViewContainer>\n      <ActionsContainer>\n        <ActionButton onClick={onGenerateNewInterpretation}>새로운 해석</ActionButton>\n        <ActionButton onClick={() => onSwitchToMode('proceed')}>나아가기</ActionButton>\n        <ActionButton onClick={() => onSwitchToMode('sentence')}>문장</ActionButton>\n      </ActionsContainer>\n      <ChatContainer ref={chatContainerRef}>\n        {messages.map((msg, index) => (\n          <Message key={index} message={msg} personas={{}} showActionButtons={false} />\n        ))}\n        {isLoading && <LoadingText>응답 생성 중...</LoadingText>}\n      </ChatContainer>\n      <InputContainer>\n        <StyledTextArea\n          value={newMessage}\n          onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => setNewMessage(e.target.value)}\n          placeholder={selectedThread ? `${personaName}에게 메시지를 보내세요...` : '먼저 해석을 시작해주세요.'}\n          disabled={!selectedThread || isLoading}\n          onKeyPress={(e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n            if (e.key === 'Enter' && !e.shiftKey) {\n              e.preventDefault();\n              handleSendMessage();\n            }\n          }}\n        />\n        <SendButton onClick={handleSendMessage} disabled={!selectedThread || isLoading}>\n          전송\n        </SendButton>\n      </InputContainer>\n    </ViewContainer>\n  );\n};\n\nexport default InterpretationView; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}